<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>会员列表-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
		<meta name="renderer" content="webkit" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0" />
		<link rel="stylesheet" href="../../static/css/font.css" />
		<link rel="stylesheet" href="../../static/css/weadmin.css" />
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
		  <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
		  <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="weadmin-nav">
			<span class="layui-breadcrumb">
				<a href="javascript:;">首页</a> <a href="javascript:;">会员管理</a>
				<a href="javascript:;"> <cite>会员列表</cite></a>
			</span>
			<a class="layui-btn layui-btn-sm" style="margin-top:3px;float:right" href="javascript:location.replace(location.href);"
			 title="刷新">
				<i class="layui-icon layui-icon-refresh"></i>
				<!-- <i class="layui-icon" style="line-height:30px">&#x1002;</i> -->
			</a>
		</div>

		<div class="weadmin-body">
			<div class="layui-row">
				<form class="layui-form layui-col-md12 we-search">
					会员搜索：
					<div class="layui-inline">
						<input id="input_username" type="text" name="username" placeholder="请输入账号" autocomplete="off" class="layui-input" />
					</div>
					<div class="layui-inline">
						<input id="input_startime" class="layui-input" placeholder="开始时间" name="start" id="start" />
					</div>
					<div class="layui-inline">
						<input id="input_endtime" class="layui-input" placeholder="结束时间" name="end" id="end" />
					</div>
					<button class="layui-btn" lay-submit="" lay-filter="search">
						<i class="layui-icon layui-icon-search"></i>
					</button>
				</form>
			</div>
			<div class="weadmin-block">
				<button class="layui-btn layui-btn-danger" onclick="delAll()">
					<i class="layui-icon layui-icon-delete"></i>批量删除
				</button>
				<button class="layui-btn" onclick="WeAdminShow('添加用户','./add.html',600,400)">
					<i class="layui-icon layui-icon-add-circle-fine"></i>添加
				</button>
			</div>

			<table class="layui-hide" id="userList" lay-filter="table"></table>

		</div>

		<!--这里是弹出层的表单信息，表单的id用于表单的选择，style是在本页隐藏，只有点击编辑才会弹出-->
		<div class="layui-row" id="userUpdate" style="display:none;">
			<div class="layui-col-md10">
				<form class="layui-form layui-from-pane" action="" style="margin-top:20px" >
					<div class="layui-form-item" style="display: none;">
						<label class="layui-form-label">id</label>
						<div class="layui-input-block">
							<input type="text" id="update_id" name="neweqptIdCode"  required  lay-verify="required" autocomplete="off" placeholder="请输入账号" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item">
						<label class="layui-form-label">账号</label>
						<div class="layui-input-block">
							<input type="text" id="update_username" name="neweqptIdCode"  required  lay-verify="required" autocomplete="off" placeholder="请输入账号" class="layui-input">
						</div>
					</div>
					<div class="layui-form-item">
						<label class="layui-form-label">密码</label>
						<div class="layui-input-block">
							<input type="text" id="update_password" name="neweqptName"  required  lay-verify="required" autocomplete="off" placeholder="请输入密码" class="layui-input">
						</div>
					</div>

					<div class="layui-form-item" style="margin-top:40px">
						<div class="layui-input-block">
							<button class="layui-btn  layui-btn-submit " lay-submit="" lay-filter="update">确认修改</button>
							<button type="reset" class="layui-btn layui-btn-primary">重置</button>
						</div>
					</div>
				</form>
			</div>
		</div>


		<!--<script type="text/javascript" src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>-->
		<script src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script src="../../static/js/eleDel.js" type="text/javascript" charset="utf-8"></script>

		<!-- 表格操作按钮集 -->
		<script type="text/html" id="barOption">
			<a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
			<!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
		</script>

		<script>
            layui.use(['table','form','layer','laydate'], function(){
                var table = layui.table
                    ,form = layui.form
                    ,layer = layui.layer
                    ,laydate = layui.laydate//日期控件
					,$=layui.$


                //设置日期控件
                laydate.render({
					elem: '#input_startime'
                    ,type: 'datetime'
                });

                laydate.render({
                    elem: '#input_endtime'
                    ,type: 'datetime'
                });

                //加载数据表
                table.render({
                    id:"userList"
                    ,elem: '#userList'  //绑定table标签 id
                    ,url:'../../user/listByListMap'  //数据请求路径
                    ,cellMinWidth: 80
                    ,cols: [[
                        {type:'checkbox'}
                        ,{field:'id', title:'ID',sort:true}
                        ,{field:'username', title:'账号',width:160,sort:true}
                        ,{field:'password', title: '密码'}
                        ,{field:'registerTime', title: '注册时间',width:160,sort:true}
                        ,{fixed: 'right',title: '操作', width:150,align:'center', toolbar: '#barOption'}//一个工具栏  具体请查看layui官网
                    ]]
                    ,page: true   //开启分页
                    ,limit:10   //默认十条数据一页
                    ,limits:[10,20,30,50]  //数据分页条
                    ,where: {//如果无需传递额外参数，可不加该参数
                        orderField: 'registerTime' //排序字段，对应 cols 设定的各字段名
                        ,orderType: 'desc' //排序方式  asc: 升序、desc: 降序、null: 默认排序
					}
					,sort: true
                    ,autoSort: false //禁用前端自动排序。
                    // ,done: function () {
                    //     $("[data-field = 'id']").css('display','none');
                    // }
                });

                //查询
                form.on('submit(search)', function(data) {
                    var username = $("#input_username").val().trim();
                    var startime = $("#input_startime").val();
                    var endtime = $("#input_endtime").val();

                    table.reload('userList', {
                        method: 'post',
                        url: '../../user/search',
                        where: {
                            username:username,
                            startime:startime,
                            endtime:endtime
                        },
                        page: {
                            curr: 1
                        }
                    });
                    return false;
                });

                //监听排序事件  后端排序
                table.on('sort(table)', function(obj){ //注：sort 是工具条事件名，table 是table标签 lay-filter="对应的值"

                    //根据当前排序的字段，重新向服务端发送请求，从而实现服务端排序，如：
                    table.reload('userList', {
                        initSort: obj //记录初始排序，如果不设的话，将无法标记表头的排序状态。
                        ,where: { //请求参数（注意：这里面的参数可任意定义，并非下面固定的格式）
                            orderField: obj.field //排序字段
                            ,orderType: obj.type //排序方式
                        }
                    });
                });


                //监听头工具栏事件
                // table.on('toolbar(test)', function(obj){
                //     var checkStatus = table.checkStatus(obj.config.id)
                //         ,data = checkStatus.data; //获取选中的数据
                //     switch(obj.event){
                //         case 'add':
                //             layer.msg('添加');
                //             break;
                //         case 'update':
                //             if(data.length === 0){
                //                 layer.msg('请选择一行');
                //             } else if(data.length > 1){
                //                 layer.msg('只能同时编辑一个');
                //             } else {
                //                 layer.alert('编辑 [id]：'+ checkStatus.data[0].id);
                //             }
                //             break;
                //         case 'delete':
                //             if(data.length === 0){
                //                 layer.msg('请选择一行');
                //             } else {
                //                 layer.msg('删除');
                //             }
                //             break;
                //     };
                // });

                //监听 行 工具事件
                table.on('tool(table)', function (obj) {//注：tool 是工具条事件名，table 是table标签原始容器的属性 lay-filter="对应的值"

                    var data = obj.data //获得当前行数据
                        ,layEvent = obj.event; //获得 lay-event 对应的值

                    if(layEvent === 'detail'){
                        layer.msg('查看操作');
                    } else if(layEvent === 'del'){
                        layer.confirm('真的删除行么', function(index){
                            // obj.del(); //删除对应行（tr）的DOM结构
                            // layer.close(index);
                            //向服务端发送删除指令
                        });
                    } else if(layEvent === 'edit'){
                        //layer.msg('编辑操作');
                        layer.open({
                            //layer提供了5种层类型。可传入的值有：0（信息框，默认）1（页面层）2（iframe层）3（加载层）4（tips层）
                            type: 1,
                            title: "修改用户",
                            area: ['420px', '330px'],
                            content: $("#userUpdate")//引用的弹出层的页面层的方式加载修改界面表单
                        });
                        //修改页面传参
                        var id = data.id;
                        var username = data.username;
                        var password = data.password;

                        $("#update_id").val(id);
                        $("#update_username").val(username);
                        $("#update_password").val(password);
                    }

                });

                //监听修改按钮
                form.on('submit(update)', function() {
                    var id =  $("#update_id").val();
                    var username = $("#update_username").val();
                    var password = $("#update_password").val();
                    $.ajax({
                        url: '../../user/update',
                        type:'POST',
                        dataType: "json",
                        data:{
							id:id,
                            username:username,
                            password:password
                        },
                        success:function (data) {
                            // debugger
                            if(data.result==true){
                                layer.closeAll();
                                layer.msg(data.msg, {icon: 6});
							}else {
                                layer.closeAll();
                                layer.msg(data.msg, {icon: 5});
							}
                            table.reload('userList');
                        },
						error:function () {
							alert("===")
                        }
                    });
                    return false;
                });


            });


		</script>
	</body>
</html>
